---
#- name: configure and enable lnet
  #hosts: lustre_client,lustre_router,lustre_server
- name: Write out lnet config
  template:
    src: lnet.conf.j2
    dest: /etc/lnet.conf
  register: lnetconf
- name: Ensure lnet is started
  service:
    name: lnet
    state: started
    enabled: true
- name: Export existing lnet conf
  command: "lnetctl export /etc/lnet.conf.old"
- name: Delete existing lnet conf
  command: "lnetctl import --del /etc/lnet.conf.old"
  ignore_errors: yes # will get errors from exported non-deletable bits like "peer ni"
- name: Import new lnet conf
  command: "lnetctl import /etc/lnet.conf"
  