- name: Configure lustre routers
  hosts: lustre_router
  gather_facts: false
  become: True
  tasks:
    - name: enable lustre client repo
      yum_repository:
        name: lustre-client
        description: lustre-client
        file: lustre-repo
        baseurl: https://downloads.whamcloud.com/public/lustre/lustre-{{ lustre.release }}/el7/client
        gpgcheck: no
    - name: ensure kernel headers available
      package:
        # EPEL needed to install dkms
        name: kernel-devel,epel-release
    - name: Install Lustre Client DKMS
      yum:
        name: "lustre-client-dkms-{{ lustre.release }}"
        state: present
    - name: Install Lustre Client kmods
      yum:
        name: "kmod-lustre-client-{{ lustre.release }}"
        state: present
    - name: Install Lustre Client
      yum:
        name: "lustre-client-{{ lustre.release }}"
        state: present
    - name: Put SELinux in permissive mode, logging actions that would be blocked.
      selinux:
        policy: targeted
        state: permissive
    - name: configure and enable lnet
      import_tasks: lnet.yml